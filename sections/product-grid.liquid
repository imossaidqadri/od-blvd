{% comment %}
  Reusable product grid section that displays products from a selected collection
  in a bento/masonry grid layout. Can be added to any page via the theme editor.
{% endcomment %}

{% liquid
  assign selected_collection = section.settings.collection
  assign products_to_show = section.settings.products_count
%}

<div class="product-grid-section">
  {% if section.settings.show_title and selected_collection.title != blank %}
    <h2 class="product-grid-section__title">{{ selected_collection.title }}</h2>
  {% endif %}

  {% if selected_collection != blank and selected_collection.products_count > 0 %}
    <div class="product-grid" style="--columns-desktop: {{ section.settings.columns_desktop }}; --columns-tablet: {{ section.settings.columns_tablet }}; --columns-mobile: {{ section.settings.columns_mobile }}; --grid-gap: {{ section.settings.grid_gap }}px;">
      {% for product in selected_collection.products limit: products_to_show %}
        {% assign index = forloop.index | modulo: 9 %}
        {% case index %}
          {% when 1 %}
            {% assign size_class = 'product-card--wide' %}
          {% when 2 %}
            {% assign size_class = 'product-card--tall' %}
          {% when 5 %}
            {% assign size_class = 'product-card--large' %}
          {% when 7 %}
            {% assign size_class = 'product-card--tall' %}
          {% else %}
            {% assign size_class = '' %}
        {% endcase %}

        <a href="{{ product.url }}" class="product-card {{ size_class }}">
          <div class="product-card__image">
            {% if product.featured_image %}
              {{ product.featured_image | image_url: width: 800 | image_tag: loading: 'lazy', alt: product.title }}
            {% else %}
              {{ 'product-1' | placeholder_svg_tag: 'product-card__placeholder' }}
            {% endif %}

            {% if section.settings.show_overlay %}
              <div class="product-card__overlay">
                <div class="product-card__info">
                  <h3 class="product-card__title">{{ product.title }}</h3>
                  <p class="product-card__price">{{ product.price | money }}</p>
                </div>
              </div>
            {% endif %}
          </div>

          {% unless section.settings.show_overlay %}
            <div class="product-card__details">
              <h3 class="product-card__title">{{ product.title }}</h3>
              <p class="product-card__price">{{ product.price | money }}</p>
            </div>
          {% endunless %}
        </a>
      {% endfor %}
    </div>
  {% else %}
    <div class="product-grid-section__empty">
      <p>{{ 'sections.product_grid.no_products' | t }}</p>
    </div>
  {% endif %}
</div>

{% stylesheet %}
  .product-grid-section {
    max-width: var(--page-width);
    margin: 0 auto;
    padding: 3rem var(--page-margin);
  }

  .product-grid-section__title {
    margin: 0 0 2rem 0;
    font-size: 2rem;
    font-weight: 600;
    text-align: center;
  }

  .product-grid {
    display: grid;
    grid-template-columns: repeat(var(--columns-mobile, 1), 1fr);
    grid-auto-rows: 300px;
    gap: var(--grid-gap, 16px);
  }

  .product-card {
    display: block;
    text-decoration: none;
    color: var(--color-foreground);
    overflow: hidden;
    transition: transform 0.3s ease;
  }

  .product-card:hover {
    transform: translateY(-4px);
  }

  .product-card--wide {
    grid-column: span 2;
  }

  .product-card--tall {
    grid-row: span 2;
  }

  .product-card--large {
    grid-column: span 2;
    grid-row: span 2;
  }

  .product-card__image {
    position: relative;
    width: 100%;
    height: 100%;
    overflow: hidden;
    background: #f5f5f5;
  }

  .product-card__image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .product-card:hover .product-card__image img {
    transform: scale(1.05);
  }

  .product-card__placeholder {
    width: 100%;
    height: 100%;
  }

  .product-card__overlay {
    position: absolute;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: flex-end;
    padding: 1rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .product-card:hover .product-card__overlay {
    opacity: 1;
  }

  .product-card__info {
    color: white;
    width: 100%;
  }

  .product-card__details {
    padding: 1rem 0;
  }

  .product-card__title {
    font-size: 1rem;
    font-weight: 500;
    margin: 0 0 0.5rem 0;
  }

  .product-card__price {
    font-size: 0.875rem;
    margin: 0;
  }

  .product-grid-section__empty {
    text-align: center;
    padding: 3rem 0;
    color: #999;
  }

  @media (max-width: 767px) {
    .product-card--wide,
    .product-card--tall,
    .product-card--large {
      grid-column: span 1;
      grid-row: span 1;
    }

    .product-card__image {
      aspect-ratio: 1;
      height: auto;
    }
  }

  @media (min-width: 768px) {
    .product-grid {
      grid-template-columns: repeat(var(--columns-tablet, 2), 1fr);
      grid-auto-rows: 250px;
    }
  }

  @media (min-width: 1024px) {
    .product-grid {
      grid-template-columns: repeat(var(--columns-desktop, 3), 1fr);
      grid-auto-rows: 300px;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "t:general.product_grid",
  "settings": [
    {
      "type": "collection",
      "id": "collection",
      "label": "t:labels.collection"
    },
    {
      "type": "checkbox",
      "id": "show_title",
      "label": "t:labels.show_collection_title",
      "default": false
    },
    {
      "type": "range",
      "id": "products_count",
      "min": 6,
      "max": 48,
      "step": 3,
      "label": "t:labels.products_to_show",
      "default": 12
    },
    {
      "type": "header",
      "content": "t:general.layout"
    },
    {
      "type": "range",
      "id": "columns_desktop",
      "min": 2,
      "max": 5,
      "step": 1,
      "label": "t:labels.columns_desktop",
      "default": 3
    },
    {
      "type": "range",
      "id": "columns_tablet",
      "min": 1,
      "max": 3,
      "step": 1,
      "label": "t:labels.columns_tablet",
      "default": 2
    },
    {
      "type": "select",
      "id": "columns_mobile",
      "label": "t:labels.columns_mobile",
      "options": [
        { "value": "1", "label": "1" },
        { "value": "2", "label": "2" }
      ],
      "default": "1"
    },
    {
      "type": "range",
      "id": "grid_gap",
      "min": 8,
      "max": 48,
      "step": 4,
      "unit": "px",
      "label": "t:labels.grid_gap",
      "default": 16
    },
    {
      "type": "header",
      "content": "t:general.product_card"
    },
    {
      "type": "checkbox",
      "id": "show_overlay",
      "label": "t:labels.show_info_on_hover",
      "default": false,
      "info": "t:info.show_overlay"
    }
  ],
  "presets": [
    {
      "name": "t:general.product_grid"
    }
  ]
}
{% endschema %}
